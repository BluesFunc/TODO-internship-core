name: CI Pipeline

on:
  pull_request:
    branches: 
      - dev
      - main
  push:

jobs:
  build:
    name: Build Project with Docker Compose
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Docker Compose
        uses: docker/setup-compose-action@v1

      - name: Create .env file from .env.example
        run: cp .env.example .env

      - name: Set up Docker Compose
        run: docker compose up --build -d

  linters:
    name: Run python linters
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: "3.12"
      
    - name: Run mypy
      uses: jpetrucciani/mypy-check@master
      with:
        path: 'todo_core/'
        python_version: "3.12"
    
    - name: Run isort
      uses: isort/isort-action@v1

    - name: Run black formater
      uses: jpetrucciani/black-check@master
      with:
        path: 'todo_core/'
        config: 'setup.cfg'

    - name: Run flake8-cq
      uses: julianwachholz/flake8-action@v2
      with:
        config: "setup.cfg"
        path: "todo_core/"